<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LootAlert Bot Dashboard</title>
  <style>
    body { background:#0a192f; color:white; font-family:Poppins,sans-serif; text-align:center; margin-top:60px;}
    .box{background:#112240;padding:30px;border-radius:15px;width:380px;margin:auto;box-shadow:0 0 20px rgba(91,192,190,.4);}
    #qr{width:230px;margin-top:20px;display:none;}
    button{margin-top:20px;padding:10px 20px;background:#5bc0be;border:none;color:white;border-radius:8px;font-size:16px;cursor:pointer;}
    button:disabled{background:gray;cursor:not-allowed;}
  </style>
</head>
<body>
  <div class="box">
    <h1>üí¨ LootAlert Bot</h1>
    <p id="status">‚è≥ Loading...</p>
    <img id="qr" src="" alt="QR" />
    <button id="testBtn" disabled>üì§ Send Test Message</button>
  </div>

  <script>
    const statusEl=document.getElementById("status");
    const qrEl=document.getElementById("qr");
    const btn=document.getElementById("testBtn");

    async function check(){
      try{
        const res=await fetch("/api/qr");
        const data=await res.json();
        if(data.status==="connected"){
          statusEl.innerHTML="‚úÖ WhatsApp Connected!";
          qrEl.style.display="none";
          btn.disabled=false;
        }else if(data.status==="qr"){
          statusEl.innerHTML="üì≤ Scan this QR to connect WhatsApp";
          qrEl.src=data.qr;
          qrEl.style.display="block";
        }else{
          statusEl.innerHTML="‚è≥ Waiting for QR...";
        }
      }catch(e){
        statusEl.innerHTML="‚ùå Server not responding";
      }
    }

    async function sendMsg(){
      statusEl.innerHTML="Sending message...";
      const res=await fetch("/api/send",{method:"POST"});
      const data=await res.json();
      if(data.ok)statusEl.innerHTML=data.message;
      else statusEl.innerHTML="‚ùå "+data.error;
    }

    btn.addEventListener("click",sendMsg);
    setInterval(check,2000);
  </script>
</body>
</html>